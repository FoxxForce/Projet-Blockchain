<!DOCTYPE html>
<html>
<head>
	<title>Blockchain</title>
	<style>
        .details {
            display: none;
            margin-left: 30px;
            padding-bottom: 5px;
            border-bottom: 1px solid black;
        }

        .details .transaction {
            border: 1px solid black;
            margin-top: 5px;
            padding: 5px;
        }

	</style>
</head>
<body>
	<h1>Blockchain Explorer</h1>
	<table>
		<thead>
			<tr>
				<th>Previous Hash</th>
				<th>Data</th>
				<th>Difficulty</th>
				<th>Nonce</th>
				<th>Miner Public Key</th>
				<th>Details</th>
			</tr>
		</thead>
		<tbody id="blockchain-table">
		</tbody>
	</table>
	<script>
		fetch("http://localhost:5000/blockchain")
			.then(response => response.json())
			.then(data => {
                data = JSON.parse(data)
				data.forEach(block => {             
					const row = document.createElement("tr");
					row.innerHTML = `
						<td>${block.previous_hash}</td>
						<td>${block.data.length} transaction(s)</td>
						<td>${block.difficulty}</td>
						<td>${block.nonce}</td>
						<td>${block.miner_public_key}</td>
						<td><button onclick="toggleDetails(event)">Show Details</button></td>
					`;

					const details = document.createElement("div");
					details.classList.add("details");
					block.data.forEach(transaction => {
                        const transactionElement = document.createElement("div");
                        transactionElement.classList.add("transaction");
                        const text = "<p>Sender: " + transaction["sender"] + "</p>" +
                                    "<p>Receiver: " + transaction["receiver"] + "</p>" +
                                    "<p>Amont: " + transaction["amount"] + "</p>" +
                                    "<p>Signature: " + transaction["signature"] + "</p>"
                        transactionElement.innerHTML = text;
                        details.appendChild(transactionElement);
                    });
					row.appendChild(details);
					document.getElementById("blockchain-table").appendChild(row);
				});
			})
			.catch(error => console.error(error));

		function toggleDetails(event) {
			const button = event.target;
			const row = button.parentNode.parentNode;
			const details = row.querySelector(".details");

			if (details.style.display === "none") {
				details.style.display = "block";
				button.innerText = "Hide Details";
			} else {
				details.style.display = "none";
				button.innerText = "Show Details";
			}
		}
	</script>
</body>
</html>
